import{o as e,u as t}from"./index-CuaxoJ3D.js";var n=t(),r=()=>{let[t,r]=(0,n.useState)([]),[i,a]=(0,n.useState)([]),[o,s]=(0,n.useState)(!0),[c,l]=(0,n.useState)(null);(0,n.useEffect)(()=>{u()},[]);let u=async()=>{s(!0);try{let[t,n]=await Promise.all([e.getProducts(),e.getMovements()]);r(t),a(n)}catch(e){console.error(`Erro ao carregar dados:`,e),l(`Falha ao carregar dados do servidor.`)}finally{s(!1)}},d=async n=>{try{let i={...n,id:crypto.randomUUID(),createdAt:new Date().toISOString(),quantity:parseInt(n.quantity)||0},a=await e.createProduct(i);return r([...t,a]),a}catch(e){console.error(`Erro ao criar produto:`,e),alert(`Erro ao salvar produto.`)}},f=async(n,i)=>{try{let a=await e.updateProduct(n,i);r(t.map(e=>e.id===n?a:e))}catch(e){console.error(`Erro ao atualizar produto:`,e)}};return{products:t,movements:i,loading:o,error:c,addProduct:d,updateProduct:f,deleteProduct:async n=>{if(confirm(`Tem certeza que deseja excluir este produto?`))try{await e.deleteProduct(n),r(t.filter(e=>e.id!==n))}catch(e){console.error(`Erro ao deletar produto:`,e)}},addMovement:async(n,r,o,s=`sale`)=>{let c=t.find(e=>e.id===r);if(!c)return;let l=parseInt(o),u=n===`in`?parseInt(c.quantity)+l:parseInt(c.quantity)-l;if(u<0){alert(`Quantidade insuficiente em estoque!`);return}try{await f(r,{quantity:u});let t={id:crypto.randomUUID(),type:n,category:n===`in`?`purchase`:s,product_id:r,productName:c.name,quantity:l,date:new Date().toISOString(),created_at:new Date().toISOString()};a([await e.createMovement(t),...i])}catch(e){console.error(`Erro ao registrar movimentação:`,e),alert(`Erro ao registrar movimentação.`)}},getStats:()=>({totalProducts:t.length,lowStock:t.filter(e=>e.quantity<(e.min_stock||5)).length,totalValue:t.reduce((e,t)=>e+t.price*t.quantity,0)}),getDashboardMetrics:()=>{let e=new Date,n=new Date(e.setDate(e.getDate()-30)),r=i.filter(e=>e.type===`out`&&e.category===`sale`&&new Date(e.date||e.created_at)>=n),a=r.reduce((e,t)=>e+t.quantity,0),o=t.reduce((e,t)=>e+parseInt(t.quantity),0),s=o>0?(a/o).toFixed(2):0,c={};return r.forEach(e=>{let t=e.product_id||e.productId;c[t]=(c[t]||0)+e.quantity}),{turnoverRate:s,topSellingProducts:Object.entries(c).map(([e,n])=>{let r=t.find(t=>t.id===e);return r?{name:r.name,quantity:n}:null}).filter(Boolean).sort((e,t)=>t.quantity-e.quantity).slice(0,5),stagnantProducts:t.filter(e=>parseInt(e.quantity)===0?!1:!r.some(t=>(t.product_id||t.productId)===e.id)),totalLossValue:i.filter(e=>e.type===`out`&&e.category===`loss`).reduce((e,n)=>{let r=n.product_id||n.productId,i=t.find(e=>e.id===r);return e+n.quantity*(i?i.price:0)},0)}}}};export{r as t};